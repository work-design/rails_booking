var calendarEl = document.getElementById('calendar');
var calendar = new FullCalendar.Calendar(calendarEl, {
  schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
  plugins: [ 'dayGrid', 'timeGrid', 'resourceDayGrid', 'resourceTimeGrid' ],
  header: {
    left: 'prev,next',
    center: '',
    right: ''
  },
  defaultView: 'timeGrid',
  defaultDate: '<%= @settings[:defaultDate] %>',
  columnHeaderFormat: {
    weekday: 'short'
  },
  dayCount: 7,
  allDaySlot: false,
  minTime: '<%= @settings[:minTime] %>',
  maxTime: '<%= @settings[:maxTime] %>',
  slotDuration: '<%= @settings[:slotDuration] %>',
  slotLabelInterval: '<%= @settings[:slotLabelInterval] %>',
  slotLabelFormat: {
    hour: 'numeric',
    minute: '2-digit',
    omitZeroMinute: true,
    hour12: false
  },
  events: <%= raw @time_plan.time_list.events(7).to_json %>,
  eventClick: function(info) {
    var url = new URL(window.location);
    var data = new FormData(document.getElementById('time_plan_form'));
    data.set('time_item_id', info.event.id);
    data.set('time_item_start', info.event.start.toISOString());

    Rails.ajax({url: url, type: 'POST', data: data, dataType: 'script'});
  }
});

calendar.render();
